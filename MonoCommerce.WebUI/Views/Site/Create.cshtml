@model MonoCommerce.WebUI.Models.SiteViewModel

@{
    ViewData["Title"] = "Yeni Site Ekle";
}

<div class="container mt-4">
    <h2 class="mb-3">Yeni Site Ekle</h2>
    <p class="text-muted">Yeni bir site eklemek i√ßin a≈üaƒüƒ±daki formu doldurun.</p>

    @if (ViewBag.DomainMessage != null)
    {
        var message = ViewBag.DomainMessage.ToString();
        var isSuccess = message.Contains("‚úÖ");
        var alertClass = isSuccess ? "alert-success" : "alert-danger";
        <div class="alert @alertClass" role="alert">
            @Html.Raw(message)
        </div>
    }

    <hr />

    <!-- üåê DOMAIN TEST & EXPORT ALANI -->
    <div class="card p-4 mb-4 shadow-sm">
        <h4 class="mb-3">üåê Domain ƒ∞≈ülemleri (Test)</h4>

        <div class="d-flex flex-wrap gap-2">
            <!-- domain kontrol, satƒ±n alma ve dns formlarƒ±nda input name = url olmalƒ± domain deƒüil -->

            <!-- Domain Kontrol -->
            <form method="post" asp-action="CheckDomain">
                @Html.AntiForgeryToken()
                <input type="hidden" name="url" id="domainCheck" value="@(Model.Url ?? "testdomain.xyz")" />
                <button type="submit" class="btn btn-primary">Domain Kontrol Et</button>
            </form>

            <!-- Satƒ±n Alma -->
            <form method="post" asp-action="PurchaseDomain">
                @Html.AntiForgeryToken()
                <input type="hidden" name="url" id="domainPurchase" value="@(Model.Url ?? "testdomain.xyz")" />
                <button type="submit" class="btn btn-success">Satƒ±n Al (Test)</button>
            </form>

            <!-- DNS Sim√ºlasyonu -->
            <form method="post" asp-action="UpdateDnsTest">
                @Html.AntiForgeryToken()
                <input type="hidden" name="url" id="domainDns" value="@(Model.Url ?? "testdomain.xyz")" />
                <button type="submit" class="btn btn-info">DNS Sim√ºlasyon (Test)</button>
            </form>

            <!-- HTML Export Local -->
            <form id="exportLocalForm" method="post" asp-action="ExportLocal">
                @Html.AntiForgeryToken()
                <button type="submit" class="btn btn-warning">HTML Export Local</button>
            </form>

            <!-- HTML Export Server -->
            <form id="exportServerForm" method="post" asp-action="ExportServer">
                @Html.AntiForgeryToken()
                <button type="submit" class="btn btn-secondary">HTML Export Server (Simulate)</button>
            </form>
        </div>

        @if (ViewBag.Message != null)
        {
            var msg = ViewBag.Message.ToString();
            var success = msg.Contains("‚úÖ");
            var alertColor = success ? "alert-success" : "alert-danger";
            <div class="alert @alertColor mt-3">
                @msg
            </div>
        }
    </div>

    <hr />

    <!-- üü© SITE OLU≈ûTURMA FORMU -->
    <form id="createForm" asp-action="Create" method="post" class="needs-validation" novalidate>
        @Html.AntiForgeryToken()

        <!-- URL ALANI -->
        <div class="mb-3">
            <label asp-for="Url" class="form-label">Site URL</label>
            <input asp-for="Url" class="form-control" id="UrlInput" placeholder="ornekdomain.xyz" />
            <span asp-validation-for="Url" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="Name" class="form-label">Site Adƒ±</label>
            <input asp-for="Name" class="form-control" />
        </div>

        <div class="mb-3">
            <label asp-for="Description" class="form-label">A√ßƒ±klama</label>
            <textarea asp-for="Description" class="form-control"></textarea>
        </div>

        <div class="mb-3 form-check">
            <input asp-for="IsActive" class="form-check-input" />
            <label asp-for="IsActive" class="form-check-label">Aktif mi?</label>
        </div>

        <div class="mb-3">
            <label asp-for="ProductId" class="form-label">√úr√ºn</label>
            <select asp-for="ProductId" class="form-select" asp-items="ViewBag.Products">
                <option value="">Se√ßiniz</option>
            </select>
        </div>

        <div class="mb-3">
            <label asp-for="ImageUrl" class="form-label">Site Resim URL</label>
            <input asp-for="ImageUrl" class="form-control" />
        </div>

        <div class="mb-3">
            <label asp-for="Prices" class="form-label">Fiyat</label>
            <input asp-for="Prices" class="form-control" />
        </div>

        <div class="mb-3">
            <label asp-for="PaymentMethod" class="form-label">√ñdeme Y√∂ntemi</label>
            <input asp-for="PaymentMethod" class="form-control" />
        </div>

        <div class="mb-3">
            <label asp-for="Currency" class="form-label">Para Birimi</label>
            <input asp-for="Currency" class="form-control" />
        </div>

        <h5>ƒ∞leti≈üim</h5>
        <div class="form-check mb-2">
            <input asp-for="WhatsappEnabled" class="form-check-input" />
            <label asp-for="WhatsappEnabled" class="form-check-label">Whatsapp Aktif mi?</label>
        </div>

        <div class="mb-3">
            <label asp-for="WhatsappPhone" class="form-label">Whatsapp Telefon</label>
            <input asp-for="WhatsappPhone" class="form-control" />
        </div>

        <div class="mb-3">
            <label asp-for="WhatsappAvailableTime" class="form-label">Whatsapp Kullanƒ±m Zamanƒ±</label>
            <input asp-for="WhatsappAvailableTime" class="form-control" />
        </div>

        <div class="form-check mb-2">
            <input asp-for="SmsApproval" class="form-check-input" />
            <label asp-for="SmsApproval" class="form-check-label">SMS Onayƒ±</label>
        </div>

        <h5>Pixel & Tracking</h5>
        <div class="mb-3">
            <label asp-for="PixelCode" class="form-label">Pixel Kodu</label>
            <textarea asp-for="PixelCode" class="form-control" rows="3"></textarea>
        </div>

        <div class="mb-3">
            <label asp-for="PixelSpecialCode" class="form-label">√ñzel Pixel Kodu</label>
            <input asp-for="PixelSpecialCode" class="form-control" />
        </div>

        <div class="mb-3">
            <label asp-for="PixelIds" class="form-label">Pixel ID'leri</label>
            <input asp-for="PixelIds" class="form-control" />
        </div>

        <div class="mb-3">
            <label asp-for="CounterCode" class="form-label">Counter Kodu</label>
            <input asp-for="CounterCode" class="form-control" />
        </div>

        <h5>HTML ƒ∞√ßerikler</h5>
        <div class="mb-3">
            <label asp-for="HtmlContent" class="form-label">HTML ƒ∞√ßerik</label>
            <textarea asp-for="HtmlContent" class="form-control" rows="3"></textarea>
        </div>

        <div class="mb-3">
            <label asp-for="FormHtml" class="form-label">Form HTML</label>
            <textarea asp-for="FormHtml" class="form-control" rows="3"></textarea>
        </div>

        <button type="submit" class="btn btn-primary">Kaydet ve Export</button>
        <a asp-action="Index" class="btn btn-secondary ms-2">ƒ∞ptal</a>
    </form>
</div>

<!-- üîß JAVASCRIPT -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const urlInput = document.getElementById("UrlInput");
    const domainInputs = [
        document.getElementById("domainCheck"),
        document.getElementById("domainPurchase"),
        document.getElementById("domainDns")
    ];

    function syncDomainInputs() {
        domainInputs.forEach(input => {
            if (input) input.value = urlInput.value;
        });
    }

    urlInput.addEventListener("input", syncDomainInputs);
    syncDomainInputs(); // sayfa ilk a√ßƒ±ldƒ±ƒüƒ±nda da g√ºncelle

    // Export formlarƒ±na t√ºm Create form verilerini aktar
    const mainForm = document.getElementById("createForm");
    const exportForms = [document.getElementById("exportLocalForm"), document.getElementById("exportServerForm")];

    exportForms.forEach(form => {
        if (!form) return;
        form.addEventListener("submit", function () {
            const formData = new FormData(mainForm);
            for (const [key, value] of formData.entries()) {
                let hidden = form.querySelector(`input[name='${key}']`);
                if (!hidden) {
                    hidden = document.createElement("input");
                    hidden.type = "hidden";
                    hidden.name = key;
                    form.appendChild(hidden);
                }
                hidden.value = value;
            }
        });
    });
});
</script>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}